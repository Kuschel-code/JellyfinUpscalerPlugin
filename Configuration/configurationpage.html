<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>AI Upscaler Configuration</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: transparent;
            color: inherit;
        }
        
        .config-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .config-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 164, 220, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(0, 164, 220, 0.3);
        }
        
        .config-header h1 {
            color: #00a4dc;
            margin: 0 0 10px 0;
            font-size: 2.2em;
        }
        
        .config-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .config-section h2 {
            color: #00a4dc;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid rgba(0, 164, 220, 0.3);
            padding-bottom: 8px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
        }
        
        .setting-label {
            flex: 1;
            font-weight: 500;
            margin-right: 15px;
            min-width: 150px;
        }
        
        .setting-control {
            flex: 2;
            min-width: 200px;
        }
        
        .setting-description {
            flex: 1;
            font-size: 0.9em;
            opacity: 0.7;
            margin-left: 15px;
            font-style: italic;
        }
        
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: inherit;
            font-size: 14px;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 8px;
        }
        
        .checkbox-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
        }
        
        .checkbox-row label {
            cursor: pointer;
            display: flex;
            align-items: center;
            font-weight: 500;
        }
        
        .button-row {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #00a4dc;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0080b3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
            background: #28a745;
        }
        
        .info-box {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid rgba(40, 167, 69, 0.3);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-box h3 {
            color: #28a745;
            margin: 0 0 10px 0;
            font-size: 1.2em;
        }
        
        .info-box p {
            margin: 0;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="config-container">
        <div class="config-header">
            <h1>üéÆ AI Upscaler Plugin</h1>
            <p><strong>Version 1.3.6.3 - ULTIMATE Edition</strong></p>
            <p>Advanced AI Upscaling Configuration for Jellyfin</p>
        </div>

        <div class="info-box">
            <h3>üöÄ Plugin Successfully Installed!</h3>
            <p>The AI Upscaler Plugin is now active. Configure your settings below and look for the "üéÆ AI" button in your video player.</p>
        </div>

        <div class="config-section">
            <h2>‚öôÔ∏è Basic Settings</h2>
            
            <div class="checkbox-row">
                <label>
                    <input type="checkbox" id="EnablePlugin" checked>
                    <span class="status-indicator"></span>
                    Enable AI Upscaler Plugin
                </label>
                <span class="setting-description">Master switch for the plugin</span>
            </div>
            
            <div class="checkbox-row">
                <label>
                    <input type="checkbox" id="ShowPlayerButton" checked>
                    <span class="status-indicator"></span>
                    Show Quick Settings in Video Player
                </label>
                <span class="setting-description">Adds AI upscaling button to video player</span>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">Default AI Model:</div>
                <div class="setting-control">
                    <select id="Model">
                        <option value="realesrgan" selected>Real-ESRGAN (Best Overall)</option>
                        <option value="esrgan-pro">ESRGAN Pro (Movies & TV)</option>
                        <option value="swinir">SwinIR (Complex Scenes)</option>
                        <option value="srcnn-light">SRCNN Light (Fast Processing)</option>
                        <option value="waifu2x">Waifu2x (Anime Content)</option>
                        <option value="hat">HAT (High Detail)</option>
                        <option value="edsr">EDSR (Precise Upscaling)</option>
                        <option value="vdsr">VDSR (Deep Learning)</option>
                        <option value="rdn">RDN (Texture Enhancement)</option>
                        <option value="srresnet">SRResNet (Basic)</option>
                        <option value="carn">CARN (Compact & Fast)</option>
                        <option value="rrdbnet">RRDBNet (Balanced)</option>
                        <option value="drln">DRLN (Noise Reduction)</option>
                        <option value="fsrcnn">FSRCNN (Lightweight)</option>
                    </select>
                </div>
                <div class="setting-description">Primary AI model for upscaling</div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">Scale Factor:</div>
                <div class="setting-control">
                    <select id="ScaleFactor">
                        <option value="2">2x Upscaling</option>
                        <option value="3" selected>3x Upscaling</option>
                        <option value="4">4x Upscaling</option>
                    </select>
                </div>
                <div class="setting-description">Default upscaling factor</div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">Quality Level:</div>
                <div class="setting-control">
                    <select id="QualityLevel">
                        <option value="high">High Quality (Best Results)</option>
                        <option value="medium" selected>Medium Quality (Balanced)</option>
                        <option value="low">Low Quality (Fastest)</option>
                    </select>
                </div>
                <div class="setting-description">Quality vs speed balance</div>
            </div>
        </div>

        <div class="config-section">
            <h2>üîß Hardware Settings</h2>
            
            <div class="checkbox-row">
                <label>
                    <input type="checkbox" id="EnableHardwareAcceleration" checked>
                    <span class="status-indicator"></span>
                    Enable Hardware Acceleration
                </label>
                <span class="setting-description">Use GPU for faster processing</span>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">Max VRAM Usage (MB):</div>
                <div class="setting-control">
                    <input type="number" id="MaxVRAMUsage" value="2048" min="512" max="16384">
                </div>
                <div class="setting-description">Maximum VRAM to use for upscaling</div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">CPU Threads:</div>
                <div class="setting-control">
                    <input type="number" id="CpuThreads" value="4" min="1" max="32">
                </div>
                <div class="setting-description">Number of CPU threads for processing</div>
            </div>
        </div>

        <div class="config-section">
            <h2>üéÆ Video Player Integration</h2>
            
            <div class="checkbox-row">
                <label>
                    <input type="checkbox" id="EnableNotifications" checked>
                    <span class="status-indicator"></span>
                    Enable Notifications
                </label>
                <span class="setting-description">Show upscaling progress notifications</span>
            </div>
            
            <div class="checkbox-row">
                <label>
                    <input type="checkbox" id="AutoRetryButton" checked>
                    <span class="status-indicator"></span>
                    Auto-Retry Button Injection
                </label>
                <span class="setting-description">Automatically retry if button doesn't appear</span>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">Button Position:</div>
                <div class="setting-control">
                    <select id="ButtonPosition">
                        <option value="right" selected>Right Side</option>
                        <option value="left">Left Side</option>
                        <option value="center">Center</option>
                    </select>
                </div>
                <div class="setting-description">Position of AI button in video player</div>
            </div>
        </div>

        <div class="button-row">
            <button class="btn btn-primary" onclick="saveConfiguration()">üíæ Save Configuration</button>
            <button class="btn btn-secondary" onclick="resetConfiguration()">üîÑ Reset to Defaults</button>
        </div>
    </div>

    <script type="text/javascript">
        (function() {
            'use strict';
            
            // Configuration object
            var config = {
                EnablePlugin: true,
                ShowPlayerButton: true,
                Model: 'realesrgan',
                ScaleFactor: 3,
                QualityLevel: 'medium',
                EnableHardwareAcceleration: true,
                MaxVRAMUsage: 2048,
                CpuThreads: 4,
                EnableNotifications: true,
                AutoRetryButton: true,
                ButtonPosition: 'right'
            };

            // Initialize when DOM is ready
            function init() {
                loadConfiguration();
                updateUI();
                console.log('AI Upscaler Plugin configuration page loaded');
            }

            function loadConfiguration() {
                try {
                    // Try to get current configuration from Jellyfin
                    var pluginId = 'f87f700e-679d-43e6-9c7c-b3a410dc3f22';
                    if (window.ApiClient && ApiClient.getPluginConfiguration) {
                        ApiClient.getPluginConfiguration(pluginId).then(function(currentConfig) {
                            if (currentConfig) {
                                config = Object.assign(config, currentConfig);
                                updateUI();
                            }
                        }).catch(function(error) {
                            console.log('Using default configuration:', error);
                        });
                    }
                } catch (e) {
                    console.log('Configuration load error:', e);
                }
            }

            function updateUI() {
                // Update all form controls with current config
                Object.keys(config).forEach(function(key) {
                    var element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = !!config[key];
                        } else {
                            element.value = config[key] || '';
                        }
                    }
                });
            }

            window.saveConfiguration = function() {
                try {
                    // Collect all form values
                    Object.keys(config).forEach(function(key) {
                        var element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') {
                                config[key] = element.checked;
                            } else if (element.type === 'number') {
                                config[key] = parseInt(element.value) || 0;
                            } else {
                                config[key] = element.value;
                            }
                        }
                    });

                    var pluginId = 'f87f700e-679d-43e6-9c7c-b3a410dc3f22';
                    
                    // Save via Jellyfin API
                    if (window.ApiClient && ApiClient.updatePluginConfiguration) {
                        ApiClient.updatePluginConfiguration(pluginId, config).then(function() {
                            showNotification('‚úÖ Configuration saved successfully!', 'success');
                            // Inject player button after saving
                            injectPlayerButton();
                        }).catch(function(error) {
                            showNotification('‚ùå Failed to save: ' + error.message, 'error');
                        });
                    } else {
                        // Fallback
                        localStorage.setItem('aiUpscalerConfig', JSON.stringify(config));
                        showNotification('‚úÖ Configuration saved (fallback mode)', 'success');
                        injectPlayerButton();
                    }
                } catch (error) {
                    showNotification('‚ùå Save error: ' + error.message, 'error');
                }
            };

            window.resetConfiguration = function() {
                if (confirm('Reset all settings to defaults?')) {
                    config = {
                        EnablePlugin: true,
                        ShowPlayerButton: true,
                        Model: 'realesrgan',
                        ScaleFactor: 3,
                        QualityLevel: 'medium',
                        EnableHardwareAcceleration: true,
                        MaxVRAMUsage: 2048,
                        CpuThreads: 4,
                        EnableNotifications: true,
                        AutoRetryButton: true,
                        ButtonPosition: 'right'
                    };
                    
                    updateUI();
                    showNotification('‚úÖ Settings reset to defaults', 'info');
                }
            };

            function showNotification(message, type) {
                try {
                    // Use Jellyfin's notification system if available
                    if (window.Dashboard && Dashboard.alert) {
                        Dashboard.alert(message);
                        return;
                    }
                } catch (e) {
                    // Fallback to custom notification
                }
                
                // Custom notification
                var notification = document.createElement('div');
                notification.style.cssText = 
                    'position: fixed; top: 20px; right: 20px; z-index: 10000; ' +
                    'background: ' + (type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8') + '; ' +
                    'color: white; padding: 12px 20px; border-radius: 6px; font-weight: 500; ' +
                    'opacity: 0; transform: translateY(-10px); transition: all 0.3s ease;';
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(function() {
                    notification.style.opacity = '1';
                    notification.style.transform = 'translateY(0)';
                }, 100);
                
                setTimeout(function() {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateY(-10px)';
                    setTimeout(function() {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            function injectPlayerButton() {
                if (!config.ShowPlayerButton) return;
                
                // Inject the AI button into video player
                var script = document.createElement('script');
                script.textContent = `
                    (function() {
                        function addAIButton() {
                            var playerControls = document.querySelector('.videoPlayerContainer .videoControls, .osdControls');
                            if (playerControls && !document.getElementById('aiUpscalerButton')) {
                                var aiButton = document.createElement('button');
                                aiButton.id = 'aiUpscalerButton';
                                aiButton.innerHTML = 'üéÆ AI';
                                aiButton.title = 'AI Upscaler Quick Settings';
                                aiButton.style.cssText = 'background: #00a4dc; color: white; border: none; padding: 8px 12px; border-radius: 4px; margin: 0 5px; cursor: pointer; font-weight: bold;';
                                
                                aiButton.onclick = function() {
                                    var menu = document.getElementById('aiQuickMenu');
                                    if (menu) {
                                        menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
                                    } else {
                                        createQuickMenu();
                                    }
                                };
                                
                                playerControls.appendChild(aiButton);
                                console.log('AI Upscaler button injected successfully');
                            }
                        }
                        
                        function createQuickMenu() {
                            var menu = document.createElement('div');
                            menu.id = 'aiQuickMenu';
                            menu.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); color: white; padding: 20px; border-radius: 8px; z-index: 10000; min-width: 300px;';
                            menu.innerHTML = 
                                '<h3 style="margin: 0 0 15px 0; color: #00a4dc;">üéÆ AI Upscaler Quick Settings</h3>' +
                                '<p><strong>Model:</strong> ' + config.Model + '</p>' +
                                '<p><strong>Scale:</strong> ' + config.ScaleFactor + 'x</p>' +
                                '<p><strong>Quality:</strong> ' + config.QualityLevel + '</p>' +
                                '<button onclick="document.getElementById(\\'aiQuickMenu\\').style.display=\\'none\\'" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin: 10px 5px 0 0; cursor: pointer;">‚úÖ Apply</button>' +
                                '<button onclick="document.getElementById(\\'aiQuickMenu\\').style.display=\\'none\\'" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin: 10px 0 0 5px; cursor: pointer;">‚ùå Close</button>';
                            
                            document.body.appendChild(menu);
                        }
                        
                        // Try to add button immediately
                        addAIButton();
                        
                        // Also try after page changes
                        var retryCount = 0;
                        var maxRetries = 10;
                        var retryInterval = setInterval(function() {
                            if (retryCount >= maxRetries) {
                                clearInterval(retryInterval);
                                return;
                            }
                            addAIButton();
                            retryCount++;
                        }, 2000);
                        
                        // Listen for navigation changes
                        if (window.Emby && Emby.Page) {
                            Emby.Page.addEventListener('viewshow', addAIButton);
                        }
                    })();
                `;
                
                // Execute the script
                var head = document.head || document.getElementsByTagName('head')[0];
                head.appendChild(script);
            }

            // Initialize when ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>
</html>