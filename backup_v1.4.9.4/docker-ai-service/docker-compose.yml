# AI Upscaler Service Docker Compose
# Jellyfin AI Upscaler Plugin - Microservice Architecture

services:
  ai-upscaler:
    build: .
    image: jellyfin-ai-upscaler:latest
    container_name: jellyfin-ai-upscaler
    restart: unless-stopped
    ports:
      - "5000:5000"
    volumes:
      - ./models:/app/models
      - ./cache:/app/cache
    environment:
      - LOG_LEVEL=INFO
      - MAX_CONCURRENT_REQUESTS=4
      - DEFAULT_SCALE=2
      - USE_GPU=true
    # GPU Support (NVIDIA)
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Optional: CPU-only version (no GPU required)
  # ai-upscaler-cpu:
  #   build: .
  #   image: jellyfin-ai-upscaler:cpu
  #   container_name: jellyfin-ai-upscaler-cpu
  #   restart: unless-stopped
  #   ports:
  #     - "5001:5000"
  #   volumes:
  #     - ./models:/app/models
  #     - ./cache:/app/cache
  #   environment:
  #     - USE_GPU=false
